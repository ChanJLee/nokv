make || exit $?

mkdir out
./main `pwd`/out demo

addr2line_cmd=""
if [[ `uname` == "Linux" ]]; then
  addr2line_cmd="| grep multi_proces | cut -d  ')' -f1 | cut -d '+' -f2 | xargs -I {} addr2line -e multi_process -a {}"
fi

echo "test muti process"
rm `pwd`/out/mp.nokv
ps | grep multi_process | awk '{print $1}' | xargs -I {} kill -9 {}
./multi_process `pwd`/out mp


#4 + 8  + 1 + 1 = 14 boolean
#4 + 7 + 1 + 4 + 13 = 29 > 43 string
#4 + 6 + 1 + 4 = 15 > 58 float
#4 + 6 + 1 + 4 = 15 > 73 int32
#4 + 6 + 1 + 8 = 19 > 92 int64
#4 + 7 + 1 + 4 + 5 = 21 > 113 suffix
#4 + 7 + 1 + 4 + 12 = 28 > 141 string

# remove
#4 + 8  + 1 + 1 = 14 boolean
#4 + 6 + 1 + 4 = 15 > 29 float
#4 + 6 + 1 + 4 = 15 > 44 int32
#4 + 6 + 1 + 8 = 19 > 63 int64
#4 + 7 + 1 + 4 + 5 = 21 > 84 suffix
#4 + 7 + 1 + 4 + 12 = 28 > 112 string

# full
#0000000   n   o   k   v   4 022  \0 001 274 272  \t   W 247  \0  \0  \0
#0000020  \a  \0  \0  \0   b   o   o   l   e   a   n  \0   B 001 006  \0
#0000040  \0  \0   s   t   r   i   n   g  \0   S  \f  \0  \0  \0   h   e
#0000060   l   l   o       w   o   r   l   d   2  \0 005  \0  \0  \0   f
#0000100   l   o   a   t  \0   F 332 017   I   @ 005  \0  \0  \0   i   n
#0000120   t   3   2  \0   I   V   4 022  \0 005  \0  \0  \0   i   n   t
#0000140   6   4  \0   L 252 252 276 272  \0  \0  \0  \0 006  \0  \0  \0
#0000160   s   u   f   f   i   x  \0   S 004  \0  \0  \0   =   =   =   =
#0000200  \0 005  \0  \0  \0   a   r   r   a   y  \0   A 021  \0  \0  \0
#0000220   S 002  \0  \0  \0   a   1  \0   N   S 002  \0  \0  \0   a   3
#0000240  \0  \a  \0  \0  \0   s   u   f   f   i   x   2  \0   S 004  \0
#0000260  \0  \0   =   =   =   =  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
#0000300  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0

# no string
#0000000   n   o   k   v   4 022  \0 001   \   v   �   �   �  \0  \0  \0
#0000020  \a  \0  \0  \0   b   o   o   l   e   a   n  \0   B 001 005  \0
#0000040  \0  \0   f   l   o   a   t  \0   F   � 017   I   @ 005  \0  \0
#0000060  \0   i   n   t   3   2  \0   I   V   4 022  \0 005  \0  \0  \0
#0000100   i   n   t   6   4  \0   L   �   �   �   �  \0  \0  \0  \0 006
#0000120  \0  \0  \0   s   u   f   f   i   x  \0   S 004  \0  \0  \0   =
#0000140   =   =   =  \0 006  \0  \0  \0   s   t   r   i   n   g  \0   S
#0000160  \v  \0  \0  \0   h   e   l   l   o       w   o   r   l   d  \0
#0000200 005  \0  \0  \0   a   r   r   a   y  \0   A 021  \0  \0  \0   S
#0000220 002  \0  \0  \0   a   1  \0   N   S 002  \0  \0  \0   a   3  \0
#0000240  \a  \0  \0  \0   s   u   f   f   i   x   2  \0   S 004  \0  \0
#0000260  \0   =   =   =   =  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
#0000300  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
#*
#0040000

# with overwrite string
#0000000   n   o   k   v   4 022  \0 001   W 220   �   L   �  \0  \0  \0
#0000020  \a  \0  \0  \0   b   o   o   l   e   a   n  \0   B 001 005  \0
#0000040  \0  \0   f   l   o   a   t  \0   F   � 017   I   @ 005  \0  \0
#0000060  \0   i   n   t   3   2  \0   I   V   4 022 005  \0  \0  \0   f
#0000100   l   o   a   t  \0   F   � 017   I   @ 005  \0  \0  \0   i   n
#0000120   t   3   2  \0   I   V   4 022  \0 005  \0  \0  \0   i   n   t
#0000140   6   4  \0   L 006  \0  \0  \0   s   t   r   i   n   g  \0   S
#0000160  \v  \0  \0  \0   h   e   l   l   o       w   o   r   l   d  \0
#0000200 005  \0  \0  \0   a   r   r   a   y  \0   A 021  \0  \0  \0   S
#0000220 002  \0  \0  \0   a   1  \0   N   S 002  \0  \0  \0   a   3  \0
#0000240  \a  \0  \0  \0   s   u   f   f   i   x   2  \0   S 004  \0  \0
#0000260  \0   =   =   =   =  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
#0000300  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
#*
#0040000
